<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workiva API Gateway Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* --- CSS STYLES --- */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0d0d12;
      color: #e0e0e0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      box-sizing: border-box;
      background-image:
        linear-gradient(to right, rgba(0,200,200,0.02) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,200,200,0.02) 1px, transparent 1px);
      background-size: 30px 30px;
      background-attachment: fixed;
      margin: 0;
    }

    /* --- HELPER CLASS --- */
    .hidden { display: none !important; }

    /* --- Main Layout --- */
    .demo-container {
      display: flex;
      width: 1250px;
      background-color: rgba(12, 12, 16, 0.98);
      border: 1px solid rgba(0,220,220,0.3);
      border-radius: 6px;
      box-shadow: 0 0 30px rgba(0,255,255,0.2), inset 0 0 15px rgba(0,255,255,0.05);
      overflow: hidden;
      height: 88vh;
      position: relative;
      z-index: 1;
      background-image:
        linear-gradient(to right, rgba(0,220,220,0.03) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,220,220,0.03) 1px, transparent 1px);
      background-size: 25px 25px;
    }
    .demo-container::before {
      content: '';
      position: absolute;
      top: -5px; bottom: -5px; left: -5px; right: -5px;
      background: linear-gradient(45deg, rgba(0,255,255,0.5), rgba(0,100,200,0.5));
      z-index: -1;
      filter: blur(20px);
      opacity: 0.3;
      border-radius: 10px;
    }

    /* --- Left Panel (Flow) --- */
    .flow-panel {
      width: 40%;
      padding: 25px;
      border-right: 1px solid rgba(0,220,220,0.2);
      overflow-y: hidden;
      position: relative;
      background-color: #0b0b10;
      background-image:
        linear-gradient(45deg, rgba(0,255,255,0.05) 1px, transparent 1px),
        linear-gradient(135deg, rgba(0,255,255,0.05) 1px, transparent 1px),
        radial-gradient(circle, rgba(0,255,255,0.08) 1px, transparent 1px),
        linear-gradient(to right, rgba(0,200,255,0.15) 0%, transparent 10%, transparent 90%, rgba(0,200,255,0.15) 100%),
        radial-gradient(circle at 15% 15%, rgba(0,255,255,0.1) 0%, transparent 20%),
        radial-gradient(circle at 85% 85%, rgba(0,200,255,0.1) 0%, transparent 15%);
      background-size: 30px 30px, 30px 30px, 5px 5px, 100% 1px, 150px 150px, 120px 120px;
      background-position: 0 0, 0 0, 0 0, center center, 0 0, 100% 100%;
      background-repeat: repeat, repeat, repeat, no-repeat, no-repeat, no-repeat;
    }

    .status-panel {
      width: 60%;
      padding: 25px;
      overflow-y: auto;
      position: relative;
      backdrop-filter: blur(5px);
      background-color: rgba(0,0,0,0.3);
    }

    h2, h3 {
      font-family: 'Roboto Mono', monospace;
      color: #00e0e0;
      border-bottom: 1px solid rgba(0,220,220,0.2);
      padding-bottom: 8px;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 15px;
      margin-top: 0;
    }
    .flow-panel h2 { font-size: 1.3em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 20px; }
    h3 { font-size: 1.2em; margin-top: 25px; }

    /* --- Flow Box Styles --- */
    .flow-box {
      background-color: rgba(0,220,220,0.05);
      border: 1px solid rgba(0,220,220,0.2);
      border-radius: 4px;
      padding: 12px;
      margin: 14px 0;
      font-weight: 700;
      font-size: 1em;
      position: relative;
      transition: all 0.3s ease;
      color: #e0e0e0;
      box-shadow: inset 0 0 5px rgba(0,220,220,0.1);
      backdrop-filter: blur(5px);
    }
    .flow-box small {
      display: block;
      font-family: 'Roboto Mono', monospace;
      font-weight: 400;
      color: #00c0c0;
      opacity: 0.8;
      font-size: 0.75em;
      margin-top: 4px;
    }
    #flow-erp { border-color: rgba(0,150,255,0.4); border-left: 3px solid #0088cc; }
    #flow-hris { border-color: rgba(0,200,200,0.4); border-left: 3px solid #00cc88; }
    #flow-dwh { border-color: rgba(0,180,220,0.4); border-left: 3px solid #cc8800; }
    #flow-workiva { border-color: rgba(100,100,255,0.4); border-left: 3px solid #8844cc; }

    .flow-box-final {
      background-color: rgba(0,220,220,0.02);
      border: 1px dashed rgba(0,220,220,0.3);
      color: #888;
      text-align: center;
      padding: 12px;
      border-radius: 4px;
      margin-top: 15px;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.9em;
    }
    .arrow {
      text-align: center;
      font-size: 1.5em;
      color: rgba(0,255,255,0.6);
      text-shadow: 0 0 8px rgba(0,255,255,0.5);
      animation: pulse-arrow 2s infinite alternate;
      margin: 2px 0;
    }
    @keyframes pulse-arrow {
      from { text-shadow: 0 0 4px rgba(0,255,255,0.2); opacity: 0.7; }
      to { text-shadow: 0 0 12px rgba(0,255,255,0.6); opacity: 1; }
    }

    .status-indicator {
      display: inline-block;
      width: 12px; height: 12px; border-radius: 50%; background-color: #333; margin-right: 10px; vertical-align: middle; transition: all 0.3s ease; box-shadow: 0 0 5px rgba(0,220,220,0.2);
    }
    .flow-box.running .status-indicator { background-color: #00e0e0; animation: pulse-cyan 1s infinite; }
    .flow-box.success .status-indicator { background-color: #00dd00; box-shadow: 0 0 8px rgba(0,221,0,0.5); }
    .flow-box.fail .status-indicator { background-color: #dd0000; }
    @keyframes pulse-cyan {
      0% { box-shadow: 0 0 0 0 rgba(0,220,220, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(0,220,220, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0,220,220, 0); }
    }

    /* --- Buttons --- */
    #run-button, #run-step-4-button, #run-step-5-button {
      width: 100%; padding: 15px; font-size: 1.2em; font-weight: 700; color: #fff; border: none; border-radius: 4px; cursor: pointer; margin-top: 30px; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 2px; position: relative; overflow: hidden;
      background: linear-gradient(135deg, #005588, #0088cc);
      box-shadow: 0 4px 15px rgba(0,136,204,0.4);
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    #run-button:hover, #run-step-4-button:hover, #run-step-5-button:hover {
      background: linear-gradient(135deg, #006699, #0099dd);
      box-shadow: 0 6px 20px rgba(0,136,204,0.6);
      transform: translateY(-2px);
    }
    #run-button:disabled, #run-step-4-button:disabled, #run-step-5-button:disabled {
      background: #2a2a35; color: #888; cursor: not-allowed; box-shadow: none; border: none; transform: none;
    }

    /* --- Status Panel (Right) --- */
    #status-table {
      width: 100%; border-collapse: separate; border-spacing: 0;
      font-family: 'Roboto Mono', monospace;
      background-color: rgba(0,0,0,0.3);
      border: 1px solid rgba(0,220,220,0.15);
      border-radius: 6px;
      overflow: hidden;
    }
    #status-table th, #status-table td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(0,220,220,0.1); color: #e0e0e0; }
    #status-table th { background-color: rgba(0,220,220,0.1); color: #00e0e0; }
    #status-table td.status-success { color: #00ff00 !important; font-weight: 700; text-shadow: 0 0 5px rgba(0,255,0,0.3); }
    #status-table td.status-running { color: #00ffff !important; font-weight: 700; }

    #data-stream {
      background-color: #08080c;
      border: 1px solid rgba(0,220,220,0.2);
      padding: 15px;
      border-radius: 4px;
      max-height: 200px; overflow-y: auto;
      font-family: 'Roboto Mono', monospace; font-size: 0.9em; color: #d0d0d0;
      white-space: pre-wrap; overflow-x: auto;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }

    /* --- Step 3 Message --- */
    #step3-message-container {
      text-align: center; margin-top: 30px;
      border: 1px solid rgba(0,220,220,0.5);
      padding: 20px;
      border-radius: 6px;
      background-color: rgba(0,20,30,0.8);
      box-shadow: 0 0 30px rgba(0,220,220,0.2), inset 0 0 20px rgba(0,220,220,0.1);
      position: relative; overflow: hidden;
      background-image: linear-gradient(rgba(0,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,255,255,0.05) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    #step3-message-container::after {
      content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: radial-gradient(circle, rgba(0,255,255,0.1) 0%, transparent 60%);
      animation: rotate-glow 10s linear infinite; pointer-events: none;
    }
    @keyframes rotate-glow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    #step3-message { font-size: 1.6em; font-weight: 700; border-bottom: none; margin: 0; padding: 0; line-height: 1.2; color: #00ffff; text-shadow: 0 0 10px rgba(0,255,255,0.4); width: 90%; margin: 0 auto; display: block; }
    #step3-submessage { font-size: 1.0em; color: #00ffff; opacity: 0.8; margin: 10px auto 0 auto; font-family: 'Inter', sans-serif; font-weight: 500; line-height: 1.3; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 90%; display: block; }

    /* --- Dashboard --- */
    #step4-dashboard {
      background-color: rgba(10,10,15,0.6); border-radius: 6px; padding: 20px; display: flex; flex-direction: column; height: 100%;
      border: 1px solid rgba(0,220,220,0.25); box-shadow: 0 5px 20px rgba(0,0,0,0.5); backdrop-filter: blur(5px);
      background-image: linear-gradient(45deg, rgba(0,200,200,0.03) 1px, transparent 1px), linear-gradient(135deg, rgba(0,200,200,0.03) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .dashboard-header { display: flex; justify-content: space-between; align-items: center; padding: 0 0 20px 0; border-bottom: 2px solid rgba(0,220,220,0.3); margin-bottom: 20px; }
    .dashboard-title { font-size: 1.8em; font-weight: 700; color: #00e0e0; text-transform: uppercase; letter-spacing: 2px; }
    .dashboard-subtitle { font-size: 1.2em; color: #c0c0c0; font-weight: 500; }
    .dashboard-grid { display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: auto 1fr; gap: 20px; flex-grow: 1; overflow-y: auto; padding-right: 10px; }
    .dashboard-card { background-color: rgba(20,20,30,0.5); border-radius: 6px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; border: 1px solid rgba(0,220,220,0.1); transition: border-color 0.3s ease; }
    .dashboard-card:hover { border-color: rgba(0,220,220,0.3); }
    .dashboard-card.narrative { grid-column: 1 / -1; }
    .card-header { font-size: 1.3em; font-weight: 600; color: #00e0e0; border-bottom: 1px solid rgba(0,220,220,0.15); padding-bottom: 12px; margin-bottom: 15px; letter-spacing: 0.5px; }
    .chart-container { width: 100%; height: 250px; }
    .insights-list { list-style: none; padding: 0; margin: 0; }
    .insights-list li { padding: 12px 15px 12px 25px; border-bottom: 1px solid rgba(0,220,220,0.1); position: relative; }
    .insights-list li::before { content: ''; position: absolute; left: 0; top: 16px; width: 8px; height: 8px; background-color: #00e0e0; transform: rotate(45deg); box-shadow: 0 0 5px rgba(0,220,220,0.6); }
    .insights-list li:last-child { border-bottom: none; }
    .insight-title { font-weight: 700; color: #f0f0f0; font-size: 1.05em; margin-bottom: 5px; }
    .insight-text { font-size: 0.95em; color: #cccccc; line-height: 1.5; }
    .insights-list li.positive::before { background-color: #00cc66; } .insights-list li.negative::before { background-color: #ff5555; } .insights-list li.warning::before { background-color: #ffbb33; }

    /* --- AI Sentinel --- */
    #step5-ai-sentinel { background-color: rgba(10,10,15,0.6); border-radius: 6px; padding: 25px; display: flex; flex-direction: column; height: 100%; border: 1px solid rgba(0,220,220,0.25); box-shadow: 0 0 20px rgba(0,220,220,0.15); backdrop-filter: blur(5px); }
    .ai-header { display: flex; align-items: center; font-size: 1.8em; font-weight: 700; color: #00e0e0; text-transform: uppercase; padding: 0 0 20px 0; border-bottom: 2px solid rgba(0,220,220,0.3); margin-bottom: 20px; letter-spacing: 2px; }
    .ai-icon { font-size: 1.4em; margin-right: 20px; color: #00e0e0; filter: drop-shadow(0 0 8px rgba(0,255,255,0.6)); }
    .ai-body { flex-grow: 1; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    .ai-loader { text-align: center; color: #00e0e0; font-family: 'Roboto Mono', monospace; font-size: 1.2em; }
    .ai-loader .spinner { width: 80px; height: 80px; border: 8px solid rgba(0,220,220,0.1); border-top-color: #00e0e0; border-radius: 50%; animation: spin-ai 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite; margin: 0 auto 30px auto; box-shadow: 0 0 20px rgba(0,220,220,0.3); }
    @keyframes spin-ai { to { transform: rotate(360deg); } }
    #ai-response-stream { background-color: #08080c; border: 1px solid rgba(0,220,220,0.3); padding: 20px; border-radius: 6px; max-height: 450px; overflow-y: auto; font-family: 'Roboto Mono', monospace; font-size: 0.95em; color: #d0d0d0; white-space: pre-wrap; width: 100%; box-shadow: inset 0 0 15px rgba(0,0,0,0.6); line-height: 1.5; }

    .apexcharts-text { fill: #c0c0c0 !important; font-family: 'Inter', sans-serif !important; }
    .apexcharts-tooltip { background-color: #1a1a25 !important; border: 1px solid #00e0e0 !important; box-shadow: 0 0 10px rgba(0,220,220,0.3) !important; color: #e0e0e0 !important; }
    .apexcharts-tooltip-title { background-color: #0a0a10 !important; border-bottom: 1px solid rgba(0,220,220,0.2) !important; font-family: 'Roboto Mono', monospace !important; }
    .apexcharts-xaxistooltip { background-color: #1a1a25 !important; border: 1px solid #00e0e0 !important; color: #00e0e0 !important; }
  </style>
</head>
<body>

  <div class="demo-container">
    
    <div class="flow-panel">
      <h2>API Gateway - Orchestration Flow</h2>
      
      <div class="flow-box" id="flow-erp">
        <span class="status-indicator"></span>
        ERP SYSTEM CALL
        <small>api.erp.com/getFinancials</small>
      </div>
      
      <div class="arrow">&darr;</div>
      
      <div class="flow-box" id="flow-hris">
        <span class="status-indicator"></span>
        HRIS SYSTEM CALL
        <small>api.hris.com/getEmployees</small>
      </div>
      
      <div class="arrow">&darr;</div>
      
      <div class="flow-box" id="flow-dwh">
        <span class="status-indicator"></span>
        DATA WAREHOUSE QUERY
        <small>SELECT * FROM enterprise_dwh</small>
      </div>
      
      <div class="arrow">&darr;</div>
      
      <div class="flow-box" id="flow-workiva">
        <span class="status-indicator"></span>
        WORKIVA SUBMIT
        <small>workiva.com/submitReportData</small>
      </div>
      
      <div class="arrow">&darr;</div>
      <div class="flow-box-final">Aggregated_Response</div>
      
      <button id="run-button">RUN</button>
    </div>
    
    <div class="status-panel">
      
      <div id="step1-2-content">
        <h3>System Call Status</h3>
        <table id="status-table">
          <thead>
            <tr>
              <th>System Call</th>
              <th>Status</th>
              <th>Time (ms)</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody>
            </tbody>
        </table>
        
        <h3>Aggregated Data Stream (JSON)</h3>
        <pre id="data-stream">
          </pre>
      </div>
      
      <div id="step3-message-container" class="hidden">
        <h3 id="step3-message">
           Board Report is Ready in Workiva
        </h3>
        <p id="step3-submessage">
          Data has been curated and audited and is now ready to be published
        </p>
      </div>
      
      <button id="run-step-4-button" class="hidden">
        FETCH & DISPLAY DASHBOARD
      </button>
      
      <div id="step4-dashboard" class="hidden">
        <div class="dashboard-header">
          <div class="dashboard-title">Curated Board Report</div>
          <div class="dashboard-subtitle">Q4 Executive Overview</div>
        </div>
  
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-header">Q4 Financial Performance</div>
            <div class="chart-container" id="finance-bar-chart"></div>
          </div>
          <div class="dashboard-card">
            <div class="card-header">Headcount by Dept</div>
            <div class="chart-container" id="hr-donut-chart"></div>
          </div>
          <div class="dashboard-card narrative">
            <div class="card-header">Key Narrative Insights</div>
            <ul class="insights-list" id="insights-container">
              </ul>
          </div>
        </div>
      </div>
      
      <button id="run-step-5-button" class="hidden">
        Invoke Strategic Sentinel AI
      </button>
      
      <div id="step5-ai-sentinel" class="hidden">
        <div class="ai-header">
          <span class="ai-icon">&#x2316;</span> Strategic Sentinel AI
        </div>
        <div class="ai-body">
          <div class="ai-loader">
            <div class="spinner"></div>
            <p>Analyzing curated public data from Workiva...</p>
          </div>
          <pre id="ai-response-stream" class="hidden"></pre>
        </div>
      </div>
      
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      
      const runButton = document.getElementById('run-button');
      const statusTableBody = document.querySelector('#status-table tbody');
      const dataStream = document.getElementById('data-stream');
      const step3MessageContainer = document.getElementById('step3-message-container');
      const runStep4Button = document.getElementById('run-step-4-button');
      const step1to2Content = document.getElementById('step1-2-content');
      const step4Dashboard = document.getElementById('step4-dashboard');
      const insightsContainer = document.getElementById('insights-container');
      const runStep5Button = document.getElementById('run-step-5-button');
      const step5AISentinel = document.getElementById('step5-ai-sentinel');
      const aiLoader = step5AISentinel.querySelector('.ai-loader');
      const aiResponseStream = document.getElementById('ai-response-stream');
      let financeChart = null, hrChart = null, autoResetTimer = null;

      const flowBoxes = {
        erp: document.getElementById('flow-erp'),
        hris: document.getElementById('flow-hris'),
        dwh: document.getElementById('flow-dwh'),
        workiva: document.getElementById('flow-workiva')
      };

      /* --- MOCKED DATA --- */
      const mockErpData = { "revenue_actual": 120.5, "ebitda": 30.2, "op_ex": 60.1 };
      const mockHrisData = {
        "new_hires": 42, "terminations": 18, "headcount": 5890,
        "department_metrics": [
          { "dept": "Engineering", "hc": 2100 }, { "dept": "Sales", "hc": 1500 },
          { "dept": "Marketing", "hc": 800 }, { "dept": "Finance", "hc": 600 },
          { "dept": "HR", "hc": 400 }, { "dept": "Other", "hc": 490 }
        ]
      };
      const mockDwhData = { "q4_revenue_forecast": 135, "q4_op_ex_forecast": 62 };
      const aggregatedJSON = {
        "erp_data": mockErpData, "hris_data": mockHrisData, "dwh_data": mockDwhData
      };

      const mockCuratedBoardReportData = {
        key_insights: [
          { title: "Revenue Miss Analysis", text: "Q4 Revenue missed forecast by 10.7% due to APAC macroeconomic downturn.", sentiment: "negative" },
          { title: "Operational Efficiency", text: "OpEx successfully controlled, finishing 3.1% below forecast. Margins preserved despite revenue miss.", sentiment: "positive" },
          { title: "HR Attrition Risk", text: "Engineering terminations 80% above target. Mitigation plans active and recruiting accelerated.", sentiment: "warning" },
          { title: "R&D Investment Outlook", text: "R&D spend on track. New product launch schedule unaffected by OpEx tightening.", sentiment: "positive" },
          { title: "Cash Flow Position", text: "Operating cash flow remains strong at $45M, buffering Q1 Capex.", sentiment: "positive" }
        ]
      };

      /* --- AUXILIARY FUNCTIONS --- */
      function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
      function getTimestamp() { return new Date().toISOString().split('T')[1].split('.')[0]; }
      function updateFlowStatus(box, status) { box.classList.remove('running', 'success'); if (status) box.classList.add(status); }
      function addStatusRow(call, status, time) {
        const row = document.createElement('tr');
        const statusClass = status === 'Success' ? 'status-success' : 'status-running';
        row.innerHTML = `<td>${call}</td><td class="${statusClass}">${status}</td><td>${time||'...'}</td><td>${time?getTimestamp():'...'}</td>`;
        statusTableBody.appendChild(row); return row;
      }
      function updateStatusRow(row, time) { 
        row.cells[1].innerText='Success'; 
        row.cells[1].className='status-success'; 
        row.cells[2].innerText=time+'ms'; 
        row.cells[3].innerText=getTimestamp(); 
      }

      function resetDemo() {
        if (autoResetTimer) clearTimeout(autoResetTimer);
        statusTableBody.innerHTML = ''; dataStream.innerText = ''; insightsContainer.innerHTML = '';
        Object.values(flowBoxes).forEach(b => updateFlowStatus(b, null));
        step1to2Content.classList.remove('hidden'); 
        [step3MessageContainer, runStep4Button, step4Dashboard, runStep5Button, step5AISentinel].forEach(el => el.classList.add('hidden'));
        if (financeChart) { financeChart.destroy(); financeChart = null; }
        if (hrChart) { hrChart.destroy(); hrChart = null; }
        runButton.disabled = false; runButton.innerText = 'RUN';
        runStep4Button.disabled = false; runStep5Button.disabled = false;
      }

      /* --- FLOW 1 --- */
      async function runDemo() {
        resetDemo();
        runButton.disabled = true; runButton.innerText = 'RUNNING...';
        updateFlowStatus(flowBoxes.erp, 'running'); const r1 = addStatusRow('ERP CALL', 'Running'); await sleep(800); updateFlowStatus(flowBoxes.erp, 'success'); updateStatusRow(r1, 180);
        updateFlowStatus(flowBoxes.hris, 'running'); const r2 = addStatusRow('HRIS CALL', 'Running'); await sleep(600); updateFlowStatus(flowBoxes.hris, 'success'); updateStatusRow(r2, 95);
        updateFlowStatus(flowBoxes.dwh, 'running'); const r3 = addStatusRow('DWH QUERY', 'Running'); await sleep(1000); updateFlowStatus(flowBoxes.dwh, 'success'); updateStatusRow(r3, 220);
        updateFlowStatus(flowBoxes.workiva, 'running'); const r4 = addStatusRow('WORKIVA SUBMIT', 'Running'); await sleep(900); updateFlowStatus(flowBoxes.workiva, 'success'); updateStatusRow(r4, 210);
        dataStream.innerText = JSON.stringify(aggregatedJSON, null, 2);
        await sleep(3000);
        step3MessageContainer.classList.remove('hidden');
        runStep4Button.classList.remove('hidden');
        runButton.disabled = false; runButton.innerText = 'RUN';
      }

      /* --- FLOW 2 --- */
      async function runStep4() {
        runStep4Button.disabled = true; runStep4Button.innerText = 'FETCHING...';
        await sleep(1000);
        step1to2Content.classList.add('hidden'); step3MessageContainer.classList.add('hidden'); runStep4Button.classList.add('hidden');
        step4Dashboard.classList.remove('hidden');
        renderCharts();
        populateNarrative();
        runStep5Button.classList.remove('hidden');
        runStep4Button.disabled = false; runStep4Button.innerText = 'FETCH & DISPLAY DASHBOARD';
      }

      /* --- FLOW 3 --- */
      async function runStep5() {
        runStep5Button.disabled = true; runStep5Button.innerText = 'ANALYZING...';
        step4Dashboard.classList.add('hidden'); runStep5Button.classList.add('hidden');
        step5AISentinel.classList.remove('hidden'); aiLoader.classList.remove('hidden'); aiResponseStream.classList.add('hidden');

        // >>>>> PLACE YOUR PIPEDREAM URL BELOW <<<<<
        const pipedreamUrl = "https://eoln72jzpl1cv2k.m.pipedream.net"; 

        try {
          const full_report_package = {
            company: "Global Corp (Demo)", period: "Q4 2024",
            financials: { actuals: mockErpData, forecast: mockDwhData },
            hr_data: mockHrisData,
            board_narratives: mockCuratedBoardReportData.key_insights
          };

          const response = await fetch(pipedreamUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(full_report_package)
          });

          if (!response.ok) throw new Error(`Server error: ${response.status}`);

          const aiData = await response.json();
          aiLoader.classList.add('hidden');
          aiResponseStream.innerText = typeof aiData === 'object' ? JSON.stringify(aiData, null, 2) : aiData;
          aiResponseStream.classList.remove('hidden');
          aiResponseStream.style.color = '#e0e0e0';

        } catch (error) {
          console.error("AI Error:", error);
          aiLoader.classList.add('hidden');
          aiResponseStream.innerText = "ERROR CONNECTING TO AI:\n" + error.message;
          aiResponseStream.classList.remove('hidden');
          aiResponseStream.style.color = '#ff5555';
        }
        
        runStep5Button.disabled = false; runStep5Button.innerText = 'Invoke Strategic Sentinel AI';
        autoResetTimer = setTimeout(resetDemo, 45000);
      }

      function renderCharts() {
        if (typeof ApexCharts === 'undefined') return;
        financeChart = new ApexCharts(document.querySelector("#finance-bar-chart"), {
          series: [{name:'Actual',data:[120.5,30.2,60.1]},{name:'Target',data:[135,30,62]}],
          chart: {type:'bar',height:250,toolbar:{show:false},foreColor:'#a0a0a0',background:'transparent',fontFamily:'Inter'},
          plotOptions:{bar:{horizontal:false,columnWidth:'50%',borderRadius:2}},dataLabels:{enabled:false},
          grid:{borderColor:'rgba(0,220,220,0.1)',xaxis:{lines:{show:false}},yaxis:{lines:{show:true}}},
          xaxis:{categories:['Revenue','EBITDA','OpEx'],axisBorder:{color:'rgba(0,220,220,0.2)'},labels:{style:{colors:'#00e0e0',fontWeight:600}}},
          yaxis:{title:{text:'$ M'},labels:{style:{colors:'#00e0e0'}}},
          tooltip:{theme:'dark',y:{formatter:v=>`$${v}M`}},colors:['#00aaff','#0088cc'],legend:{position:'top',offsetY:-10,labels:{colors:'#c0c0c0'}}
        }); financeChart.render();
        hrChart = new ApexCharts(document.querySelector("#hr-donut-chart"), {
          series: [2100,1500,800,600,400,490], labels: ['Eng','Sales','Mkt','Fin','HR','Oth'],
          chart: {type:'donut',height:250,foreColor:'#a0a0a0',background:'transparent',fontFamily:'Inter'},
          plotOptions:{pie:{donut:{size:'75%',labels:{show:true,total:{show:true,label:'Total',color:'#e0e0e0',formatter:()=>'5890'},value:{color:'#00e0e0',fontSize:'22px',fontWeight:700}}}}},
          dataLabels:{enabled:false},stroke:{width:2,colors:['#151520']},tooltip:{theme:'dark'},legend:{show:false},
          colors:['#00e0e0','#0099cc','#0066aa','#004488','#555555','#333333']
        }); hrChart.render();
      }
      function populateNarrative() {
        insightsContainer.innerHTML = ''; 
        mockCuratedBoardReportData.key_insights.forEach(insight => {
          const li = document.createElement('li'); li.className = insight.sentiment;
          li.innerHTML = `<div class="insight-title">${insight.title}</div><div class="insight-text">${insight.text}</div>`;
          insightsContainer.appendChild(li);
        });
      }

      runButton.addEventListener('click', runDemo);
      runStep4Button.addEventListener('click', runStep4);
      runStep5Button.addEventListener('click', runStep5);
      resetDemo();
    });
  </script>
</body>
</html>
